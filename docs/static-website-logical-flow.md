# Logical Flow of the Static Website Deployment

## 1. Infrastructure Setup Flow

The deployment process involves setting up both frontend and backend components in a logical sequence:

### Frontend Infrastructure

1. **S3 Bucket Configuration**:
   - S3 bucket created with name matching domain (`www.deployjimmy.com`)
   - Static website hosting enabled on the bucket
   - Bucket policy configured for public read access
   - Website endpoint enabled for direct access
   - Index document set to `index.html`
   - Error document set to `error.html`

2. **SSL Certificate Provisioning**:
   - Certificate requested through AWS Certificate Manager (ACM)
   - Certificate covers domain and subdomains
   - DNS validation records created in Route 53
   - Certificate validation completed and status changed to "Issued"

3. **CloudFront Distribution Setup**:
   - Distribution created with origin pointing to S3 website endpoint
   - HTTPS enforced with custom SSL certificate
   - Cache behaviors configured for optimal performance
   - Default root object set to `index.html`
   - Custom error responses configured to handle 404 errors
   - Distribution deployed to all edge locations

4. **DNS Configuration**:
   - Route 53 hosted zone configured for domain
   - Alias A-record created pointing to CloudFront distribution
   - DNS propagation allowed to complete

### Backend Infrastructure

1. **EC2 Instance Deployment**:
   - EC2 instance launched with appropriate AMI
   - Security group configured to allow traffic on port 3000
   - Instance initialized and SSH access established
   - Node.js and dependencies installed
   - Backend API code deployed to instance
   - PM2 process manager configured for application uptime

2. **API SSL Certificate**:
   - Separate certificate requested for `api.deployjimmy.com`
   - Certificate validated through DNS validation
   - Certificate status confirmed as "Issued"

3. **API CloudFront Distribution**:
   - Distribution created with origin pointing to EC2 instance on port 3000
   - Custom origin header configuration if required
   - SSL certificate attached from ACM
   - Cache behaviors optimized for API responses
   - Distribution deployed globally

4. **API DNS Configuration**:
   - Alias A-record created in Route 53 for `api.deployjimmy.com`
   - Record pointed to API CloudFront distribution
   - DNS propagation allowed to complete

## 2. Content Flow

The static site and API content flows follow different paths:

### Static Content Flow

1. **Content Creation and Upload**:
   - Static HTML, CSS, and JavaScript files created
   - Files uploaded to S3 bucket
   - Object metadata and permissions set
   - Content structure verified

2. **Content Delivery**:
   - User requests `www.deployjimmy.com` in browser
   - Request routed through DNS to CloudFront
   - CloudFront checks cache for requested objects
   - If cached, content served directly from edge location
   - If not cached, CloudFront retrieves from S3 origin
   - Content cached at edge location for future requests
   - HTML/CSS/JS delivered to user browser
   - Browser renders the static website

### API Content Flow

1. **API Request Processing**:
   - User or application sends request to `api.deployjimmy.com/api`
   - Request routed through DNS to CloudFront
   - CloudFront forwards request to EC2 origin
   - Node.js application receives request on port 3000
   - Application processes the request
   - JSON response generated by backend
   - Response returned through CloudFront to client
   - Client processes the JSON response

## 3. Security Flow

Security controls are applied at multiple layers:

1. **Transport Security**:
   - All traffic encrypted via HTTPS (TLS)
   - SSL certificates from Amazon Certificate Manager
   - Secure connections between clients and CloudFront
   - Secure connections between CloudFront and origins

2. **Access Control**:
   - S3 bucket policies limit access as needed
   - EC2 security groups restrict network traffic
   - IAM roles and policies implement least privilege
   - Origin access identity for S3 (if configured)

3. **Edge Security**:
   - CloudFront provides DDoS protection
   - Geographic restrictions if applied
   - Custom headers for origin requests if configured
   - Cache control headers for proper content handling

## 4. Request-Response Cycle

When a user accesses the deployed resources, the request follows these paths:

### Static Website Request Path

1. **User Request**:
   - User enters `www.deployjimmy.com` in browser
   - DNS query sent to Route 53
   - Route 53 returns CloudFront distribution domain
   - Browser connects to CloudFront edge location

2. **Processing and Response**:
   - CloudFront processes request
   - Request forwarded to S3 origin if not cached
   - S3 returns requested objects
   - CloudFront caches and delivers content
   - Browser renders the static website

### API Request Path

1. **Client Request**:
   - Client sends request to `api.deployjimmy.com/api`
   - DNS query resolves to CloudFront distribution
   - Request sent to nearest edge location

2. **API Processing and Response**:
   - CloudFront forwards request to EC2 origin
   - Node.js application on EC2 processes request
   - Application generates JSON response
   - Response returned through CloudFront
   - Client receives and processes response

## 5. Maintenance Flow

The ongoing maintenance process includes:

1. **Content Updates**:
   - New static content uploaded to S3
   - Cache invalidation performed if immediate update needed
   - CloudFront distributes updated content

2. **Backend Maintenance**:
   - EC2 instance updates and patches
   - Application code updates
   - PM2 ensures application stays running
   - Monitoring for availability and performance

This architecture demonstrates the integration of multiple AWS services to deliver a secure, scalable, and performant web application with separated frontend and backend components. The static content benefits from global CDN distribution, while the backend API maintains the flexibility of a compute instance with the security and performance benefits of CloudFront.